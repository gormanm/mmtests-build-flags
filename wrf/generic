CFLAGS_EXTRA="$DEFAULT_OPTIMISATION_LEVEL"
FFLAGS_EXTRA="$DEFAULT_OPTIMISATION_LEVEL"
LDFLAGS_EXTRA="$DEFAULT_OPTIMISATION_LEVEL"

case $MMTESTS_TOOLCHAIN in
gcc-10)
	FFLAGS_BASE+=" -fallow-argument-mismatch -fallow-invalid-boz"
	;;
esac

CFLAGS_EXTRA+=" $MARCH_FLAG_DEFAULT $MTUNE_FLAG_DEFAULT $COMPILE_OPT_ALWAYS"
FFLAGS_EXTRA+=" $MARCH_FLAG_DEFAULT $MTUNE_FLAG_DEFAULT $COMPILE_OPT_ALWAYS"
LDFLAGS_EXTRA+=" $MARCH_FLAG_DEFAULT $MTUNE_FLAG_DEFAULT"

build_callback() {
	sed -i -e "s/^CFLAGS_LOCAL.*/& $CFLAGS_EXTRA $MARCH_FLAG_DEFAULT $MTUNE_FLAG_DEFAULT $COMPILE_OPT_ALWAYS/" configure.wrf
	sed -i -e "s/^FCOPTIM.*/&      $FFLAGS_EXTRA $MARCH_FLAG_DEFAULT $MTUNE_FLAG_DEFAULT $COMPILE_OPT_ALWAYS/" configure.wrf
	sed -i -e "s/^FCBASEOPTS_NO_G.*/& $FFLAGS_BASE/" configure.wrf
}

log_opt "CFLAGS_EXTRA:     $CFLAGS_LOCAL"
log_opt "FCOPTIM:          $FCOPTIM"
log_opt "LDFLAGS_LOCAL:    $LDFLAGS_EXTRA"

load_standard_environment
load_mpi_environment
load_dummy_environment
